<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Socolor Designer by ThangTran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind + chroma + html2canvas -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@0,300;0,400;0,600;0,700;0,900;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@300;400;700;900&family=Great+Vibes&family=Prata&family=Oswald:wght@500;700&family=Patrick+Hand&family=Anton&display=swap"
    rel="stylesheet"
  />

  <style>
    body { font-family: "Be Vietnam Pro", sans-serif; }
    .transition-all { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

    .direction-btn.active {
      background-color: #ffffff;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border-color: #6366f1;
      color: #4f46e5;
      transform: translateY(-2px);
    }
    .direction-btn.active svg { stroke: #4f46e5; stroke-width: 2.5; }

    .style-card { transition: all 0.2s; border: 2px solid transparent; }
    .style-card:hover { transform: translateY(-2px); }
    .style-card.active {
      border-color: #4f46e5;
      background-color: #eef2ff;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
    }

    .aurora-bg {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1;
      background: #fff;
      overflow: hidden;
      will-change: transform;
      transition: transform 0.3s ease-out;
    }
    .blob {
      position: absolute;
      width: 130vw;
      height: 130vw;
      border-radius: 50%;
      filter: blur(80);
      opacity: 0.22;
      animation: float 10s infinite ease-in-out alternate;
    }
    @keyframes float {
      from { transform: translate(0, 0) scale(1); }
      to   { transform: translate(30px, -30px) scale(1.1); }
    }

    .glass {
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .text-gradient {
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-image: linear-gradient(to right, #333, #666);
    }

    .text-shadow-sm { text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .text-shadow-lg { text-shadow: 0 4px 8px rgba(0,0,0,0.3); }

    .f-script { font-family: "Great Vibes", cursive; }
    .f-hand { font-family: "Patrick Hand", cursive; }
    .f-serif-display { font-family: "Prata", serif; }
    .f-serif-text { font-family: "Playfair Display", serif; }
    .f-sans-geo { font-family: "Montserrat", sans-serif; }
    .f-sans-human { font-family: "Be Vietnam Pro", sans-serif; }
    .f-condensed { font-family: "Oswald", sans-serif; }
    .f-poster { font-family: "Anton", sans-serif; }

    #gradientToolbar {
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    #gradientToolbar.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
  </style>
</head>

<body class="text-slate-800 min-h-screen pb-48 relative">

  <!-- Aurora -->
  <div class="aurora-bg">
    <div id="blob1" class="blob bg-blue-100 top-[-20%] left-[-20%]"></div>
    <div id="blob2" class="blob bg-indigo-100 bottom-[-20%] right-[-20%]"></div>
  </div>

  <!-- Header -->
  <div class="sticky top-0 z-40 glass shadow-sm mb-10">
    <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
      <div>
        <h1 id="appLogo" class="text-2xl md:text-3xl font-extrabold tracking-tight text-gradient">
          Socolor Designer
        </h1>
        <p class="text-xs text-slate-500 font-medium">by ThangTran</p>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="max-w-5xl mx-auto px-4 space-y-16 relative z-10">

    <!-- 1. Chọn màu thương hiệu -->
    <div class="bg-white/80 p-8 rounded-[2rem] shadow-xl border border-white backdrop-blur-sm relative">
      <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-6 text-center">
        1. Chọn màu thương hiệu
      </h3>
      <div class="flex flex-col md:flex-row items-center justify-center gap-6">
        <div class="relative group">
          <input
            type="color"
            id="colorPicker"
            value="#3282E3"
            class="w-24 h-24 rounded-full cursor-pointer border-4 border-white shadow-2xl p-0 overflow-hidden transition-transform transform group-hover:scale-110"
          />
        </div>
        <div class="flex flex-col gap-2 w-full md:w-auto">
          <div class="flex items-center gap-2">
            <div
              class="flex-1 flex items-center border-2 border-slate-200 rounded-2xl overflow-hidden focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-100 transition-all bg-white h-12"
            >
              <span class="pl-4 text-slate-400 font-bold select-none">#</span>
              <input
                type="text"
                id="textInput"
                value="3282E3"
                class="w-28 py-2 px-2 outline-none font-mono font-bold text-lg text-slate-700 uppercase bg-transparent placeholder-slate-300"
                placeholder="3282E3"
              />
            </div>
            <button
              onclick="randomColor()"
              class="h-12 px-4 rounded-2xl border-2 border-slate-200 bg-white text-slate-600 hover:border-indigo-400 hover:text-indigo-600 hover:shadow-md transition-all active:scale-95 flex items-center gap-2 font-bold text-xs tracking-wide"
            >
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
              </svg>
              RANDOM
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 2. Bảng màu thương hiệu -->
    <section>
      <div class="mb-4 border-l-4 border-slate-800 pl-4">
        <h3 class="text-xl font-bold text-slate-800">Bảng màu thương hiệu</h3>
        <p class="text-xs text-slate-500 mt-1">
          Mỗi ô màu đã tính contrast với nền đang chọn ở phần WCAG. Click để copy &amp; xem chi tiết trong Color Inspector.
        </p>
      </div>
      <div class="bg-white/80 backdrop-blur p-4 md:p-6 rounded-2xl shadow-sm border border-white">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="spotPaletteContainer"></div>
      </div>
    </section>

    <!-- 3. Gradients -->
    <section id="gradientSection" class="border-top border-slate-200/60 pt-10">
      <div class="mb-4 border-l-4 border-indigo-500 pl-4">
        <h3 class="text-xl font-bold text-slate-800">Dải màu (Gradients)</h3>
        <p class="text-xs text-slate-500 mt-1">
          Dùng cho background hero, banner, cover… Các màu đều sinh từ màu thương hiệu để đảm bảo đồng bộ.
        </p>
      </div>

      <div class="bg-white/80 backdrop-blur p-4 md:p-6 rounded-2xl shadow-sm border border-white space-y-10">
        <div>
          <div class="mb-4 flex justify-between items-center">
            <h4 class="font-bold text-slate-700 text-lg">
              Generic Gradient
              <span class="text-[10px] bg-slate-50 border border-slate-200 px-2 py-1 rounded text-slate-500">HERO</span>
            </h4>
            <button
              onclick="copyCSSGradient('generic')"
              class="text-xs font-bold text-white bg-slate-800 px-4 py-2 rounded-lg shadow hover:bg-slate-900"
            >
              Copy CSS
            </button>
          </div>
          <div id="genericSmooth" class="h-20 w-full rounded-2xl mb-2 shadow-md border border-slate-100 transition-all duration-500"></div>
          <div class="grid grid-cols-3 md:grid-cols-6 gap-2" id="genericContainer"></div>
        </div>

        <div>
          <div class="mb-4 flex justify-between items-center">
            <h4 class="font-bold text-slate-700 text-lg">
              Matching Gradient
              <span class="text-[10px] bg-slate-50 border border-slate-200 px-2 py-1 rounded text-slate-500">ACCENT</span>
            </h4>
            <button
              onclick="copyCSSGradient('matching')"
              class="text-xs font-bold text-white bg-slate-800 px-4 py-2 rounded-lg shadow hover:bg-slate-900"
            >
              Copy CSS
            </button>
          </div>
          <div id="matchingSmooth" class="h-20 w-full rounded-2xl mb-2 shadow-md border border-slate-100 transition-all duration-500"></div>
          <div class="grid grid-cols-3 md:grid-cols-6 gap-2" id="matchingContainer"></div>
        </div>
      </div>
    </section>

    <!-- 4. Bảng màu lý thuyết -->
    <section class="border-t border-slate-200/60 pt-10">
      <div class="mb-6 border-l-4 border-emerald-500 pl-4">
        <h3 class="text-xl font-bold text-slate-800">Bảng màu lý thuyết</h3>
        <p class="text-xs text-slate-500 mt-1">
          Analogous / Triadic / Monochromatic / Complementary sinh từ màu thương hiệu theo vòng màu (HSL).
        </p>
      </div>
      <div id="theoryPalettesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </section>

    <!-- 5. Chú thích -->
    <section class="border-t border-slate-200/60 pt-10">
      <div class="mb-4 border-l-4 border-slate-800 pl-4">
        <h3 class="text-xl font-bold text-slate-800">Chú thích &amp; cách dùng màu</h3>
      </div>
      <div class="bg-white/80 backdrop-blur p-5 md:p-6 rounded-2xl shadow-sm border border-white text-sm text-slate-600 space-y-3">
        <p class="font-semibold text-slate-800 text-sm">1. Bảng màu thương hiệu</p>
        <ul class="list-disc list-inside space-y-1">
          <li><span class="font-semibold">Primary:</span> màu nhận diện chính của thương hiệu, dùng cho heading, nút chính.</li>
          <li><span class="font-semibold">Secondary:</span> màu phụ, dùng cho nút phụ, label, icon.</li>
          <li><span class="font-semibold">Background:</span> màu nền rất nhạt, dùng làm nền web, khung nội dung.</li>
          <li><span class="font-semibold">Accent:</span> màu nhấn mạnh (CTA, icon quan trọng, highlight).</li>
        </ul>
        <p class="font-semibold text-slate-800 text-sm pt-2">2. Bảng màu lý thuyết</p>
        <ul class="list-disc list-inside space-y-1">
          <li><span class="font-semibold">Analogous:</span> 3 màu hàng xóm trên vòng màu → mượt, êm, ít tương phản.</li>
          <li><span class="font-semibold">Triadic:</span> 3 màu cách đều 120° → tươi, năng động, dùng cho layout nhiều khối.</li>
          <li><span class="font-semibold">Monochromatic:</span> 1 hue, nhiều độ sáng → cực an toàn, khó sai, phù hợp UI &amp; dashboard.</li>
          <li><span class="font-semibold">Complementary:</span> 2 màu đối diện → tương phản mạnh, dùng khi cần nhấn rất rõ.</li>
        </ul>
        <p class="font-semibold text-slate-800 text-sm pt-2">3. Chuẩn kỹ thuật WCAG</p>
        <ul class="list-disc list-inside space-y-1">
          <li>Text thường nên có <span class="font-semibold">contrast ≥ 4.5:1</span> (AA).</li>
          <li>Text lớn (&gt;= 18px đậm) có thể dùng từ 3:1 trở lên.</li>
          <li>Pill trên từng màu cho biết contrast giữa màu đó và nền đang chọn (đỏ = fail, vàng = chỉ dùng cho text lớn, xanh = OK).</li>
        </ul>
      </div>
    </section>

    <!-- 6. WCAG & Contrast -->
    <section class="border-t border-slate-200/60 pt-10">
      <div class="mb-6 border-l-4 border-slate-800 pl-4">
        <h3 class="text-xl font-bold text-slate-800">WCAG &amp; Contrast</h3>
        <p class="text-xs text-slate-500 mt-1">
          Kiểm tra độ tương phản giữa màu chữ và màu nền theo chuẩn WCAG 2.1 (AA / AAA).
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white/80 backdrop-blur p-6 rounded-2xl shadow-sm border border-white">
          <h4 class="text-sm font-bold text-slate-800 mb-3">Preview Text (WCAG)</h4>
          <div class="flex items-center gap-3 mb-2">
            <label class="text-xs text-slate-600 flex items-center gap-2">
              Nền
              <input id="previewBgColor" type="color" value="#ffffff" class="w-8 h-8 rounded-full border border-slate-200" />
            </label>
            <label class="text-xs text-slate-600 flex items-center gap-2">
              Chữ
              <input id="previewTextColor" type="color" value="#000000" class="w-8 h-8 rounded-full border border-slate-200" />
            </label>
            <button
              id="suggestTextBtn"
              class="ml-auto text-xs font-semibold px-3 py-1.5 rounded-full border border-slate-200 bg-slate-900 text-white hover:bg-black active:scale-95 transition"
            >
              Gợi ý màu chữ
            </button>
          </div>
          <textarea
            id="textPreview"
            rows="3"
            class="w-full mt-2 p-3 rounded-xl border border-slate-200 text-sm bg-slate-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
          >Đây là đoạn text demo. Bạn có thể thay đổi nội dung, màu nền và màu chữ ở trên.</textarea>
          <p id="previewContrastLabel" class="mt-2 text-[11px] text-slate-500"></p>
        </div>

        <div class="bg-white/80 backdrop-blur p-6 rounded-2xl shadow-sm border border-white">
          <h4 class="text-sm font-bold text-slate-800 mb-3">Color Inspector</h4>
          <div class="flex items-center gap-3 mb-3">
            <div id="inspSwatch" class="w-10 h-10 rounded-full border border-slate-200 bg-slate-200"></div>
            <div>
              <div class="text-[11px] uppercase text-slate-400 font-bold">Selected color</div>
              <div id="inspHex" class="text-sm font-mono font-semibold text-slate-800">—</div>
            </div>
          </div>

          <div class="mb-3">
            <div class="text-[11px] uppercase text-slate-400 font-bold mb-1">Color model</div>
            <div class="inline-flex rounded-full border border-slate-200 bg-slate-50 text-xs overflow-hidden">
              <button id="inspTabRgb" class="px-3 py-1 border-r border-slate-200 bg-slate-900 text-white font-semibold">
                RGB
              </button>
              <button id="inspTabHsl" class="px-3 py-1 border-r border-slate-200 text-slate-600">HSL</button>
              <button id="inspTabHsv" class="px-3 py-1 text-slate-600">HSV</button>
            </div>
            <div id="inspValue" class="mt-2 text-sm text-slate-700 font-mono">RGB: —</div>
          </div>

          <div class="mt-4">
            <div class="text-[11px] uppercase text-slate-400 font-bold mb-1">Nền để test contrast</div>
            <div class="flex items-center gap-3 mb-3">
              <input id="inspBgInput" type="color" value="#ffffff" class="w-8 h-8 rounded-full border border-slate-200" />
              <span id="inspBgLabel" class="text-xs font-mono text-slate-600 uppercase">#FFFFFF</span>
            </div>
            <div class="flex items-center justify-between mb-2 gap-2">
              <div
                id="inspPreviewChip"
                class="w-20 h-10 rounded-full flex items-center justify-center text-sm font-semibold border border-slate-200 bg-white"
              >
                Aa
              </div>
              <div class="text-[10px] text-slate-500">
                Text đề xuất:
                <span id="inspTextAuto" class="font-mono">#000000</span>
              </div>
            </div>
            <div id="inspContrastLabel" class="text-[11px] text-slate-700 font-medium mb-2">Contrast: —</div>
            <div class="flex flex-wrap gap-2 text-[10px]">
              <span id="inspBadgeAA" class="px-2 py-1 rounded-full border border-slate-200 text-slate-400">AA</span>
              <span id="inspBadgeAAA" class="px-2 py-1 rounded-full border border-slate-200 text-slate-400">AAA</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 7. Text Studio -->
    <section class="border-t-2 border-slate-200/60 pt-6 mt-6">
      <!-- Intro mới -->
      <div id="introBlock" class="mb-8 max-w-xl mx-auto md:mx-0">
        <div class="flex items-stretch gap-3">
          <!-- Thanh màu trái -->
          <div
            id="introAccentBar"
            class="w-[4px] bg-emerald-400 self-stretch"
          ></div>

          <!-- 3 dòng text -->
          <div class="flex-1">
            <p
              id="introHeroTitle"
              class="text-2xl md:text-3xl font-extrabold leading-tight"
            >
              Socolor Designer
            </p>

            <p
              id="introHeroTagline"
              class="mt-1 text-[11px] md:text-xs font-semibold tracking-[0.35em] uppercase leading-snug"
            >
              TĂNG TỐC THỜI GIAN THIẾT KẾ
            </p>

            <p
              id="introHeroBody"
              class="mt-2 text-xs md:text-sm leading-snug whitespace-nowrap"
            >
              Xoá bỏ rào cản thẩm mỹ trong sáng tạo nội dung.
            </p>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
        <!-- Panel trái -->
        <div class="lg:col-span-4 space-y-6">
          <div class="bg-white/80 backdrop-blur p-6 rounded-2xl shadow-sm border border-white">
            <label class="block text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider">1. Nội dung</label>
            <div class="space-y-3">
              <textarea
                id="inputHeading"
                rows="2"
                class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none resize-none transition-all focus:bg-white"
              >Thanh Xuân</textarea>
              <input
                type="text"
                id="inputSub"
                value="Như một chén trà"
                class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-all focus:bg-white"
              />
              <textarea
                id="inputBody"
                rows="3"
                class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-xs focus:ring-2 focus:ring-indigo-500 outline-none resize-none transition-all focus:bg-white"
              >Uống vào một phát hết bà thanh xuân.</textarea>
            </div>
          </div>

          <div class="bg-white/80 backdrop-blur p-6 rounded-2xl shadow-sm border border-white">
            <label class="block text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider">2. Phong cách Font</label>
            <div class="grid grid-cols-2 gap-3" id="styleSelector"></div>
          </div>
        </div>

        <!-- Panel phải -->
        <div class="lg:col-span-8 space-y-4">
          <div
            id="typoPreviewArea"
            class="w-full aspect-[4/5] md:aspect-video rounded-[2.5rem] shadow-2xl border-4 border-white ring-1 ring-slate-200 relative overflow-hidden transition-all duration-500 flex flex-col justify-center items-center p-10 md:p-16 bg-white group"
          >
            <div id="previewBg" class="absolute inset-0 z-0 transition-colors duration-500"></div>
            <div
              id="decoShape1"
              class="absolute -top-20 -right-20 w-96 h-96 rounded-full mix-blend-multiply filter blur-3xl opacity-30 transition-colors duration-700 z-0"
            ></div>
            <div
              id="decoShape2"
              class="absolute -bottom-20 -left-20 w-80 h-80 rounded-full mix-blend-multiply filter blur-3xl opacity-30 transition-colors duration-700 z-0"
            ></div>

            <div
              class="absolute top-6 right-6 z-20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            >
              <div class="glass px-4 py-2 rounded-lg text-[10px] text-slate-500 shadow-sm backdrop-blur-md bg-white/80">
                <p>
                  Heading:
                  <span id="fontNameHead" class="font-bold text-slate-800">Font</span>
                </p>
                <p>
                  Sub:
                  <span id="fontNameSub" class="font-bold text-slate-800">Font</span>
                </p>
              </div>
            </div>

            <div
              id="contentContainer"
              class="relative z-10 text-center w-full max-w-2xl transition-all duration-500 flex flex-col"
            ></div>

            <div
              id="previewSignature"
              class="absolute bottom-4 right-6 z-20 text-xs font-semibold tracking-wide text-white/80 drop-shadow"
            >
              by ThangTran
            </div>
          </div>

          <!-- Bố cục + Xuất hình -->
          <div
            class="bg-white/80 backdrop-blur p-4 md:p-5 rounded-2xl shadow-sm border border-white flex flex-col md:flex-row md:items-center md:justify-between gap-4"
          >
            <div>
              <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider">
                Bố cục
              </label>
              <div class="flex gap-2 mt-2">
                <button
                  onclick="setLayout('center')"
                  id="layout-center"
                  class="layout-btn flex-1 py-2.5 px-3 rounded-xl border border-slate-200 hover:bg-white text-xs font-bold bg-white shadow-sm"
                >
                  Căn giữa
                </button>
                <button
                  onclick="setLayout('left')"
                  id="layout-left"
                  class="layout-btn flex-1 py-2.5 px-3 rounded-xl border border-slate-200 hover:bg-white text-xs font-bold"
                >
                  Tạp chí
                </button>
                <button
                  onclick="setLayout('poster')"
                  id="layout-poster"
                  class="layout-btn flex-1 py-2.5 px-3 rounded-xl border border-slate-200 hover:bg-white text-xs font-bold"
                >
                  Poster
                </button>
              </div>
            </div>

            <div class="md:text-right">
              <div class="text-[11px] font-bold text-slate-400 uppercase tracking-wider">
                Xuất hình
              </div>
              <div class="text-[11px] text-slate-500 mb-2">
                Lưu khung text hiện tại thành ảnh.
              </div>
              <div class="flex md:justify-end gap-2">
                <button
                  onclick="downloadPreview('png')"
                  class="text-xs font-semibold px-3 py-1.5 rounded-full border border-slate-200 bg-slate-900 text-white hover:bg-black active:scale-95 transition"
                >
                  PNG
                </button>
                <button
                  onclick="downloadPreview('jpg')"
                  class="text-xs font-semibold px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-700 hover:bg-slate-100 active:scale-95 transition"
                >
                  JPG
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer class="text-center mt-10 text-slate-400 text-sm font-medium pb-20">
    &copy; 2025 Socolor Designer. Built by ThangTran.
  </footer>

  <!-- Thanh hướng Gradient -->
  <div id="gradientToolbar" class="fixed bottom-6 left-4 right-4 z-50">
    <div
      class="glass p-3 rounded-2xl shadow-2xl border border-white/50 max-w-lg mx-auto flex items-center justify-between gap-4 bg-white/80"
    >
      <div class="flex flex-col pl-2">
        <span class="text-xs font-bold text-slate-800">Hướng Gradient</span>
        <span class="text-[10px] text-slate-500">Chạm để đổi chiều</span>
      </div>
      <div class="flex gap-2">
        <button
          onclick="setDirection('to right')"
          id="dirRight"
          class="direction-btn w-10 h-10 rounded-xl border border-transparent bg-slate-100 flex items-center justify-center transition-all active:scale-95"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-slate-600">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        </button>
        <button
          onclick="setDirection('to left')"
          id="dirLeft"
          class="direction-btn w-10 h-10 rounded-xl border border-transparent bg-slate-100 flex items-center justify-center transition-all active:scale-95"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-slate-600">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
          </svg>
        </button>
        <button
          onclick="setDirection('to bottom right')"
          id="dirDiagonal"
          class="direction-btn w-10 h-10 rounded-xl border border-transparent bg-slate-100 flex items-center justify-center transition-all active:scale-95 active"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-slate-600">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 4.5l-15 15m0 0h11.25m-11.25 0V8.25" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div
    id="toast"
    class="fixed top-20 left-1/2 transform -translate-x-1/2 glass text-slate-800 px-6 py-3 rounded-full shadow-xl opacity-0 transition-all duration-300 pointer-events-none z-[60] font-bold flex items-center gap-2 text-sm translate-y-[-20px] border border-white/50"
  >
    ✅ Đã copy!
  </div>

  <script>
    let currentDirection = "to bottom right";
    let currentColor = "#3282E3";
    let currentProPalette = null;
    let currentTheoryPalettes = [];
    let inspectorColor = null;
    let inspectorBg = "#ffffff";
    let inspectorModel = "rgb";

    const styles = [
      { id: "thanhxuan", name: "Thanh Xuân", fontHead: "f-script", nameHead: "Great Vibes", fontSub: "f-sans-geo", nameSub: "Montserrat", fontBody: "f-sans-human", isScript: true, subCase: "uppercase tracking-widest", desc: "Mềm mại, bay bổng" },
      { id: "quocdan", name: "Quốc Dân", fontHead: "f-sans-human", nameHead: "Be Vietnam Pro", fontSub: "f-sans-human", nameSub: "Be Vietnam Pro", fontBody: "f-sans-human", isScript: false, subCase: "uppercase tracking-wide", desc: "Hiện đại, rõ ràng" },
      { id: "tapchi", name: "Tạp Chí", fontHead: "f-serif-display", nameHead: "Prata", fontSub: "f-sans-geo", nameSub: "Montserrat", fontBody: "f-serif-text", isScript: false, subCase: "italic tracking-wide", desc: "Sang trọng, thời trang" },
      { id: "ngonghinh", name: "Ngộ Nghĩnh", fontHead: "f-hand", nameHead: "Patrick Hand", fontSub: "f-hand", nameSub: "Patrick Hand", fontBody: "f-sans-human", isScript: false, subCase: "lowercase tracking-wide", desc: "Vui tươi, thân thiện" },
      { id: "poster", name: "Poster Phim", fontHead: "f-poster", nameHead: "Anton", fontSub: "f-sans-geo", nameSub: "Montserrat", fontBody: "f-sans-human", isScript: false, subCase: "uppercase tracking-tighter", desc: "Mạnh mẽ, ấn tượng" },
      { id: "tho", name: "Thơ Ca", fontHead: "f-serif-text", nameHead: "Playfair", fontSub: "f-script", nameSub: "Great Vibes", fontBody: "f-serif-text", isScript: true, subCase: "normal-case text-lg", desc: "Cổ điển, lãng mạn" },
      { id: "saigonretro", name: "Saigon Retro", fontHead: "f-condensed", nameHead: "Oswald", fontSub: "f-sans-human", nameSub: "Be Vietnam Pro", fontBody: "f-serif-text", isScript: false, subCase: "uppercase tracking-[0.3em]", desc: "Đậm chất poster Sài Gòn xưa" },
      { id: "neonsocial", name: "Neon Social", fontHead: "f-sans-geo", nameHead: "Montserrat", fontSub: "f-condensed", nameSub: "Oswald", fontBody: "f-sans-human", isScript: false, subCase: "uppercase tracking-[0.25em]", desc: "Đậm nét mạng xã hội, bắt mắt" },
      { id: "softblog", name: "Soft Blog", fontHead: "f-serif-text", nameHead: "Playfair", fontSub: "f-sans-human", nameSub: "Be Vietnam Pro", fontBody: "f-sans-human", isScript: false, subCase: "normal-case tracking-wide", desc: "Nhẹ nhàng, hợp blog & bài dài" },
      { id: "handnote", name: "Handwritten Note", fontHead: "f-hand", nameHead: "Patrick Hand", fontSub: "f-sans-human", nameSub: "Be Vietnam Pro", fontBody: "f-hand", isScript: false, subCase: "normal-case", desc: "Như ghi chú tay phá cách" }
    ];
    let currentStyle = styles[0];
    let currentLayout = "center";

    function normalizeHex(hex) {
      if (!hex) return null;
      hex = String(hex).trim().toLowerCase();
      if (hex.startsWith("#")) hex = hex.slice(1);
      if (![3, 6].includes(hex.length)) return null;
      if (hex.length === 3) hex = hex.split("").map(c => c + c).join("");
      if (!/^[0-9a-f]{6}$/.test(hex)) return null;
      return "#" + hex;
    }
    function hexToRgb(hex) {
      const n = normalizeHex(hex);
      if (!n) return null;
      return {
        r: parseInt(n.slice(1, 3), 16),
        g: parseInt(n.slice(3, 5), 16),
        b: parseInt(n.slice(5, 7), 16)
      };
    }
    function rgbToHex(r, g, b) {
      const toHex = v => v.toString(16).padStart(2, "0");
      return "#" + toHex(r) + toHex(g) + toHex(b);
    }
    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s;
      const l = (max + min) / 2;
      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h *= 60;
      }
      return { h, s, l };
    }
    function hslToRgb(h, s, l) {
      h /= 360;
      let r, g, b;
      if (s === 0) {
        r = g = b = l;
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1 / 6) return p + (q - p) * 6 * t;
          if (t < 1 / 2) return q;
          if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
          return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
      }
      return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
    }
    function hslToHex(h, s, l) {
      const rgb = hslToRgb(h, s, l);
      return rgbToHex(rgb.r, rgb.g, rgb.b);
    }
    function rgbToHsv(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      const d = max - min;
      let h = 0;
      const s = max === 0 ? 0 : d / max;
      const v = max;
      if (d !== 0) {
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h *= 60;
      }
      return { h, s, v };
    }

    function generateProPalettes(baseColor) {
      if (!chroma.valid(baseColor)) return null;
      const root = chroma(baseColor);
      const clampSat = (color, maxSat = 0.85) =>
        color.get("hsl.s") > maxSat ? color.set("hsl.s", maxSat) : color;

      const genMid = clampSat(root.set("hsl.h", "-50").brighten(0.5));
      const genEnd = root.set("hsl.h", "-160").set("hsl.l", 0.92).set("hsl.s", 0.8);
      const genericScale = chroma.scale([root, genMid, genEnd]).mode("lch").colors(6);

      const matchMid = clampSat(root.set("hsl.h", "+60").brighten(0.3));
      const matchEnd = root.set("hsl.h", "+140").set("hsl.l", 0.75).set("hsl.s", 0.65);
      const matchingScale = chroma.scale([root, matchMid, matchEnd]).mode("lch").colors(6);

      const spotPalette = [
        root.hex(),
        root.set("hsl.h", "+30").set("hsl.l", 0.65).hex(),
        root.set("hsl.h", "+180").set("hsl.l", 0.92).set("hsl.s", 0.3).hex(),
        root.set("hsl.h", "+15").darken(1.2).saturate(0.5).hex()
      ];
      return { generic: genericScale, matching: matchingScale, spot: spotPalette };
    }

    function generateTheoryPalettes(baseHex) {
      const rgb = hexToRgb(baseHex);
      if (!rgb) return [];
      const { h, s, l } = rgbToHsl(rgb.r, rgb.g, rgb.b);
      const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

      return [
        {
          name: "Analogous",
          colors: [
            hslToHex((h - 30 + 360) % 360, s, l),
            baseHex,
            hslToHex((h + 30) % 360, s, l)
          ]
        },
        {
          name: "Triadic",
          colors: [
            baseHex,
            hslToHex((h + 120) % 360, s, l),
            hslToHex((h + 240) % 360, s, l)
          ]
        },
        {
          name: "Monochromatic",
          colors: [
            hslToHex(h, s, clamp(l * 0.4, 0, 1)),
            baseHex,
            hslToHex(h, s, clamp(l * 1.3, 0, 1))
          ]
        },
        {
          name: "Complementary",
          colors: [baseHex, hslToHex((h + 180) % 360, s, l)]
        }
      ];
    }

    function getLuminance(hex) {
      const rgb = hexToRgb(hex);
      if (!rgb) return null;
      const t = v => {
        const s = v / 255;
        return s <= 0.03928 ? s / 12.92 : Math.pow((s + 0.055) / 1.055, 2.4);
      };
      const R = t(rgb.r);
      const G = t(rgb.g);
      const B = t(rgb.b);
      return 0.2126 * R + 0.7152 * G + 0.0722 * B;
    }
    function getContrastRatio(hex1, hex2) {
      const L1 = getLuminance(hex1);
      const L2 = getLuminance(hex2);
      if (L1 == null || L2 == null) return null;
      const lighter = Math.max(L1, L2);
      const darker = Math.min(L1, L2);
      return (lighter + 0.05) / (darker + 0.05);
    }
    function getContrastInfo(fg, bg) {
      const ratio = getContrastRatio(fg, bg);
      if (ratio == null) {
        return { ratio: null, label: "Không tính được", passesAA: false, passesAAA: false };
      }
      const rounded = Math.round(ratio * 100) / 100;
      const passesAA = ratio >= 4.5;
      const passesAAA = ratio >= 7;
      let label = "Contrast ~ " + rounded + ":1";
      if (passesAAA) label += " (AAA)";
      else if (passesAA) label += " (AA)";
      else label += " (không đạt AA)";
      return { ratio: rounded, label, passesAA, passesAAA };
    }
    function suggestTextColorForBackground(bgHex) {
      const black = "#000000";
      const white = "#ffffff";
      const contrastBlack = getContrastRatio(black, bgHex) || 0;
      const contrastWhite = getContrastRatio(white, bgHex) || 0;
      const textColor = contrastBlack >= contrastWhite ? black : white;
      const best = Math.max(contrastBlack, contrastWhite);
      return {
        textColor,
        ratio: Math.round(best * 100) / 100,
        passesAA: best >= 4.5,
        passesAAA: best >= 7
      };
    }
    function getContrastPillClass(info) {
      if (!info || !info.ratio) return "bg-slate-500/80 text-white";
      const r = info.ratio;
      if (r >= 7) return "bg-emerald-600 text-white";
      if (r >= 4.5) return "bg-emerald-400 text-slate-900";
      if (r >= 3) return "bg-amber-400 text-slate-900";
      return "bg-rose-500 text-white";
    }

    function isLight(colorHex) {
      try { return chroma(colorHex).luminance() > 0.5; } catch { return true; }
    }
    function toTitleCase(str) {
      return str
        .toLowerCase()
        .split(" ")
        .map(w => w.charAt(0).toUpperCase() + w.slice(1))
        .join(" ");
    }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
      } catch {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
      showToast(text);
    }
    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = "✅ Đã copy: " + (msg.length > 20 ? "CSS Code" : msg);
      toast.classList.remove("opacity-0", "translate-y-[-20px]");
      setTimeout(() => {
        toast.classList.add("opacity-0", "translate-y-[-20px]");
      }, 2000);
    }

    function updateAuroraAndLogo() {
      if (!currentProPalette) return;
      document.getElementById("blob1").style.backgroundColor = chroma(currentProPalette.generic[2]).brighten(1.2).desaturate(1).hex();
document.getElementById("blob2").style.backgroundColor = chroma(currentProPalette.matching[2]).brighten(1.2).desaturate(1).hex();
      const logo = document.getElementById("appLogo");
      const gradientText = `linear-gradient(to right, ${currentProPalette.spot[0]}, ${currentProPalette.matching[5]})`;
      logo.style.backgroundImage = gradientText;
    }

    function renderSpotPalette(containerId, colors) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      const labels = ["Primary", "Secondary", "Background", "Accent"];
      colors.forEach((hex, index) => {
        const norm = normalizeHex(hex);
        if (!norm) return;
        const info = getContrastInfo(norm, inspectorBg || "#ffffff");
        const pillClass = getContrastPillClass(info);

        const wrapper = document.createElement("div");
        wrapper.className = "flex flex-col gap-2 group cursor-pointer";
        wrapper.onclick = () => handleColorClick(norm);

        const box = document.createElement("div");
        box.className =
          "h-24 rounded-xl shadow-md transition-transform group-hover:-translate-y-1 border border-slate-100 relative";
        box.style.backgroundColor = norm;

        const overlay = document.createElement("div");
        overlay.className =
          "absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity";
        overlay.innerHTML =
          '<span class="bg-black/20 text-white text-xs font-bold px-2 py-1 rounded-full backdrop-blur-sm">Copy</span>';

        const pill = document.createElement("div");
        pill.className =
          "absolute top-1 right-2 text-[10px] px-2 py-0.5 rounded-full " + pillClass;
        pill.textContent = info && info.ratio ? info.ratio + ":1" : "n/a";

        box.appendChild(overlay);
        box.appendChild(pill);

        const textDiv = document.createElement("div");
        textDiv.className = "text-center flex flex-col";
        textDiv.innerHTML =
          `<span class="text-xs font-mono text-slate-600 font-bold uppercase">${norm.toUpperCase()}</span>` +
          `<span class="text-[10px] text-slate-400">${labels[index] || ""}</span>`;

        wrapper.appendChild(box);
        wrapper.appendChild(textDiv);
        container.appendChild(wrapper);
      });
    }

    function updateGradientSection(type, colors) {
      const smoothEl = document.getElementById(type + "Smooth");
      const container = document.getElementById(type + "Container");
      if (!smoothEl || !container) return;
      smoothEl.style.background =
        "linear-gradient(" + currentDirection + ", " + colors.join(", ") + ")";
      container.innerHTML = "";
      colors.forEach((hex, idx) => {
        const norm = normalizeHex(hex);
        if (!norm) return;
        const wrapper = document.createElement("div");
        wrapper.className = "flex flex-col gap-1 group cursor-pointer";
        wrapper.onclick = () => handleColorClick(norm);

        const box = document.createElement("div");
        let roundedClass = "rounded-md";
        if (idx === 0) roundedClass = "rounded-bl-2xl rounded-tr-md rounded-br-md";
        if (idx === colors.length - 1)
          roundedClass = "rounded-br-2xl rounded-tl-md rounded-bl-md";
        box.className =
          "h-16 " +
          roundedClass +
          " shadow-sm transition-transform group-hover:-translate-y-1 border border-slate-100";
        box.style.backgroundColor = norm;

        const label = document.createElement("span");
        label.className =
          "text-[10px] text-center font-mono text-slate-400 font-bold uppercase group-hover:text-indigo-600 transition-colors";
        label.innerText = norm.toUpperCase();

        wrapper.appendChild(box);
        wrapper.appendChild(label);
        container.appendChild(wrapper);
      });
    }

    function updateGradientsFromCurrent() {
      if (!currentProPalette) return;
      updateGradientSection("generic", currentProPalette.generic);
      updateGradientSection("matching", currentProPalette.matching);
    }

    function renderTheoryPalettes(palettes) {
      const container = document.getElementById("theoryPalettesContainer");
      container.innerHTML = "";
      if (!palettes || !palettes.length) return;

      palettes.forEach(p => {
        const card = document.createElement("div");
        card.className =
          "bg-white/80 backdrop-blur p-4 rounded-2xl border border-white shadow-sm";

        const title = document.createElement("div");
        title.className = "text-sm font-bold text-slate-800 mb-2";
        title.textContent = p.name;
        card.appendChild(title);

        const row = document.createElement("div");
        row.className = "flex gap-3";

        p.colors.forEach(hex => {
          const norm = normalizeHex(hex);
          if (!norm) return;
          const info = getContrastInfo(norm, inspectorBg || "#ffffff");
          const pillClass = getContrastPillClass(info);

          const wrapper = document.createElement("button");
          wrapper.type = "button";
          wrapper.className =
            "flex flex-col gap-2 flex-1 group cursor-pointer text-left";
          wrapper.onclick = () => handleColorClick(norm);

          const box = document.createElement("div");
          box.className =
            "h-24 rounded-xl shadow-md transition-transform group-hover:-translate-y-1 border border-slate-100 relative";
          box.style.backgroundColor = norm;

          const pill = document.createElement("div");
          pill.className =
            "absolute top-1 right-2 text-[10px] px-2 py-0.5 rounded-full " +
            pillClass;
          pill.textContent = info && info.ratio ? info.ratio + ":1" : "n/a";
          box.appendChild(pill);

          const textDiv = document.createElement("div");
          textDiv.className = "text-center";
          const hexLabel = document.createElement("span");
          hexLabel.className =
            "text-xs font-mono text-slate-600 font-bold uppercase";
          hexLabel.textContent = norm.toUpperCase();
          textDiv.appendChild(hexLabel);

          wrapper.appendChild(box);
          wrapper.appendChild(textDiv);
          row.appendChild(wrapper);
        });

        card.appendChild(row);
        container.appendChild(card);
      });
    }

    function updateTextPreview() {
      const bgEl = document.getElementById("previewBgColor");
      const fgEl = document.getElementById("previewTextColor");
      const area = document.getElementById("textPreview");
      const label = document.getElementById("previewContrastLabel");
      if (!bgEl || !fgEl || !area || !label) return;
      const bg = bgEl.value || "#ffffff";
      const fg = fgEl.value || "#000000";
      area.style.backgroundColor = bg;
      area.style.color = fg;
      const info = getContrastInfo(fg, bg);
      label.textContent = info ? info.label : "";
    }

    function handleColorClick(hex) {
      copyText(hex);
      setInspectorColor(hex);
    }
    function setInspectorColor(hex) {
      const norm = normalizeHex(hex);
      if (!norm) return;
      inspectorColor = norm;
      updateInspector();
    }
    function setInspectorModel(model) {
      inspectorModel = model;
      ["inspTabRgb", "inspTabHsl", "inspTabHsv"].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.remove("bg-slate-900", "text-white", "font-semibold");
        el.classList.add("text-slate-600");
      });
      const active = document.getElementById(
        model === "rgb" ? "inspTabRgb" : model === "hsl" ? "inspTabHsl" : "inspTabHsv"
      );
      active &&
      active.classList.add("bg-slate-900", "text-white", "font-semibold");
      updateInspector();
    }
    function updateInspector() {
      const swatch = document.getElementById("inspSwatch");
      const hexLabel = document.getElementById("inspHex");
      const valueLabel = document.getElementById("inspValue");
      const previewChip = document.getElementById("inspPreviewChip");
      const textAuto = document.getElementById("inspTextAuto");
      const contrastLabel = document.getElementById("inspContrastLabel");
      const badgeAA = document.getElementById("inspBadgeAA");
      const badgeAAA = document.getElementById("inspBadgeAAA");

      if (!swatch || !hexLabel || !valueLabel || !previewChip || !contrastLabel) return;

      if (!inspectorColor || !normalizeHex(inspectorColor)) {
        swatch.style.backgroundColor = "#e5e7eb";
        hexLabel.textContent = "—";
        valueLabel.textContent = "RGB: —";
        previewChip.style.backgroundColor = inspectorBg || "#ffffff";
        previewChip.style.color = "#000000";
        contrastLabel.textContent = "Contrast: —";
        badgeAA.className =
          "px-2 py-1 rounded-full border border-slate-200 text-[10px] text-slate-400";
        badgeAAA.className =
          "px-2 py-1 rounded-full border border-slate-200 text-[10px] text-slate-400";
        textAuto.textContent = "#000000";
        return;
      }

      const color = normalizeHex(inspectorColor);
      swatch.style.backgroundColor = color;
      hexLabel.textContent = color.toUpperCase();

      const rgb = hexToRgb(color);
      if (rgb) {
        const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
        const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
        if (inspectorModel === "rgb") {
          valueLabel.textContent = `RGB: ${rgb.r}, ${rgb.g}, ${rgb.b}`;
        } else if (inspectorModel === "hsl") {
          valueLabel.textContent =
            "HSL: " +
            Math.round(hsl.h) +
            "°, " +
            Math.round(hsl.s * 100) +
            "%, " +
            Math.round(hsl.l * 100) +
            "%";
        } else {
          valueLabel.textContent =
            "HSV: " +
            Math.round(hsv.h) +
            "°, " +
            Math.round(hsv.s * 100) +
            "%, " +
            Math.round(hsv.v * 100) +
            "%";
        }
      } else {
        valueLabel.textContent = "Không phân tích được màu.";
      }

      const bg = inspectorBg || "#ffffff";
      const info = getContrastInfo(color, bg);
      const suggestion = suggestTextColorForBackground(bg);

      previewChip.style.backgroundColor = bg;
      previewChip.style.color = suggestion.textColor;
      textAuto.textContent = suggestion.textColor.toUpperCase();
      contrastLabel.textContent = info
        ? "Contrast: " + info.label.replace("Contrast ~ ", "")
        : "Contrast: —";

      badgeAA.className =
        "px-2 py-1 rounded-full border text-[10px] " +
        (info && info.passesAA
          ? "bg-emerald-50 border-emerald-400 text-emerald-700 font-semibold"
          : "border-slate-200 text-slate-400");
      badgeAAA.className =
        "px-2 py-1 rounded-full border text-[10px] " +
        (info && info.passesAAA
          ? "bg-emerald-50 border-emerald-400 text-emerald-700 font-semibold"
          : "border-slate-200 text-slate-400");
    }

    function initStyleSelector() {
      const container = document.getElementById("styleSelector");
      container.innerHTML = "";
      styles.forEach(s => {
        const btn = document.createElement("button");
        btn.className =
          "style-card p-3 rounded-xl bg-slate-50 text-left w-full " +
          (s.id === "thanhxuan" ? "active" : "");
        btn.onclick = () => {
          document
            .querySelectorAll(".style-card")
            .forEach(el => el.classList.remove("active"));
          btn.classList.add("active");
          currentStyle = s;
          updateTypographyPreview();
        };
        btn.innerHTML =
          `<span class="block text-sm text-slate-800 ${s.fontHead}">${s.name}</span>` +
          `<span class="block text-sm text-slate-400 mt-1">${s.desc}</span>`;
        container.appendChild(btn);
      });
    }

    function setLayout(layout) {
      currentLayout = layout;
      document.querySelectorAll(".layout-btn").forEach(el => {
        el.classList.remove("bg-white", "shadow-sm");
        el.classList.add("border-slate-200");
      });
      const btn = document.getElementById("layout-" + layout);
      btn && btn.classList.add("bg-white", "shadow-sm");
      updateTypographyPreview();
    }

    function updateTypographyPreview() {
      if (!currentProPalette) return;
      const headingEl = document.getElementById("inputHeading");
      const subEl = document.getElementById("inputSub");
      const bodyEl = document.getElementById("inputBody");
      const container = document.getElementById("contentContainer");
      const previewBg = document.getElementById("previewBg");
      const bgShape1 = document.getElementById("decoShape1");
      const bgShape2 = document.getElementById("decoShape2");
      const signature = document.getElementById("previewSignature");

      let hVal = headingEl.value;
      const sVal = subEl.value;
      const bVal = bodyEl.value;

      document.getElementById("fontNameHead").innerText = currentStyle.nameHead;
      document.getElementById("fontNameSub").innerText = currentStyle.nameSub;

      if (currentStyle.isScript) hVal = toTitleCase(hVal);

      container.innerHTML = "";
      container.className =
        "relative z-10 w-full max-w-2xl transition-all duration-500 flex flex-col h-full justify-center";

      const pHead = document.createElement("h1");
      const pSub = document.createElement("h3");
      const pBody = document.createElement("p");
      const pLine = document.createElement("div");

      pHead.innerText = hVal;
      pSub.innerText = sVal;
      pBody.innerText = bVal;

      const textShadowClass =
        currentLayout === "poster" ? "text-shadow-lg" : "text-shadow-sm";

      pHead.className =
        "mb-4 leading-tight transition-all duration-300 text-smart-balance " +
        textShadowClass +
        " " +
        currentStyle.fontHead;

      if (currentStyle.id === "poster") {
        pHead.classList.add(
          "text-7xl",
          "md:text-9xl",
          "font-black",
          "uppercase",
          "tracking-tighter"
        );
      } else if (currentStyle.id === "thanhxuan") {
        pHead.classList.add("text-6xl", "md:text-8xl", "font-normal");
      } else {
        pHead.classList.add("text-5xl", "md:text-7xl", "font-bold");
      }

      pSub.className =
        "mb-4 transition-all duration-300 text-sm font-bold " +
        currentStyle.fontSub +
        " " +
        currentStyle.subCase;
      pBody.className =
        "text-base md:text-lg leading-relaxed max-w-lg mx-auto transition-all duration-300 opacity-90 " +
        currentStyle.fontBody;

      if (currentLayout === "center") {
        container.classList.add("text-center", "items-center");
        pLine.className = "w-16 h-1 rounded-full mx-auto mb-6 transition-all";
        container.appendChild(pSub);
        container.appendChild(pHead);
        container.appendChild(pLine);
        container.appendChild(pBody);
      } else if (currentLayout === "left") {
        container.classList.add("text-left", "items-start");
        pLine.className = "w-10 h-1 rounded-full mb-6 transition-all";
        container.appendChild(pLine);
        container.appendChild(pHead);
        container.appendChild(pSub);
        container.appendChild(pBody);
      } else if (currentLayout === "poster") {
        container.classList.add("text-center", "items-center");
        container.appendChild(pSub);
        container.appendChild(pHead);
        container.appendChild(pBody);
      }

      const primary = currentProPalette.spot[0];
      const accent = currentProPalette.spot[3];

      bgShape1.style.backgroundColor = currentProPalette.generic[2];
      bgShape2.style.backgroundColor = currentProPalette.matching[2];

      if (currentLayout === "poster") {
        const midColor = currentProPalette.generic[2];
        const lightBg = isLight(midColor);
        const overlayColor = lightBg
          ? "rgba(255,255,255,0.4)"
          : "rgba(0,0,0,0.3)";
        const gradientCSS =
          "linear-gradient(" +
          currentDirection +
          ", " +
          overlayColor +
          ", " +
          overlayColor +
          "), linear-gradient(" +
          currentDirection +
          ", " +
          currentProPalette.generic.join(", ") +
          ")";
        previewBg.style.background = gradientCSS;

        const textColor = lightBg ? "#0f172a" : "#ffffff";
        pHead.style.color = textColor;
        pSub.style.color = lightBg ? primary : "#fbbf24";
        pBody.style.color = lightBg ? "#334155" : "rgba(255,255,255,0.9)";
        bgShape1.style.opacity = "0.1";
        bgShape2.style.opacity = "0.1";

        if (signature) {
          signature.style.color = lightBg ? "#0f172a" : "#f9fafb";
        }
      } else {
        previewBg.style.background = "#ffffff";
        pHead.style.color = primary;
        pSub.style.color = accent;
        pBody.style.color = "#334155";
        pLine.style.backgroundColor = accent;
        bgShape1.style.opacity = "0.4";
        bgShape2.style.opacity = "0.4";

        if (signature) {
          signature.style.color = "#64748b";
        }
      }
    }

    // Intro hero chạy màu theo palette
    function updateIntroHero() {
      if (!currentProPalette) return;
      const titleEl = document.getElementById("introHeroTitle");
      const taglineEl = document.getElementById("introHeroTagline");
      const bodyEl = document.getElementById("introHeroBody");
      const barEl = document.getElementById("introAccentBar");
      if (!titleEl || !taglineEl || !bodyEl || !barEl) return;

      const primary = currentProPalette.spot[0];
      const accent  = currentProPalette.spot[3];
      const midColor = currentProPalette.generic[2];

      titleEl.style.color = primary;
      taglineEl.style.color = accent;
      barEl.style.backgroundColor = primary;

      const bodyDark = isLight(midColor) ? "#0f172a" : "#f9fafb";
      bodyEl.style.color = bodyDark;
    }

    function setDirection(dir) {
      currentDirection = dir;
      document
        .querySelectorAll(".direction-btn")
        .forEach(btn => btn.classList.remove("active"));
      const activeId =
        dir === "to right"
          ? "dirRight"
          : dir === "to left"
          ? "dirLeft"
          : "dirDiagonal";
      document.getElementById(activeId)?.classList.add("active");
      updateGradientsFromCurrent();
      updateTypographyPreview();
    }
    async function copyCSSGradient(type) {
      if (!currentProPalette) return;
      const colors =
        type === "generic"
          ? currentProPalette.generic
          : currentProPalette.matching;
      const css =
        "background-image: linear-gradient(" +
        currentDirection +
        ", " +
        colors.join(", ") +
        ");";
      await copyText(css);
    }

    async function downloadPreview(format) {
      const node = document.getElementById("typoPreviewArea");
      if (!node || !window.html2canvas) return;
      const canvas = await html2canvas(node, {
        backgroundColor: null,
        scale: 2
      });
      const mime = format === "jpg" ? "image/jpeg" : "image/png";
      const dataURL = canvas.toDataURL(mime, 0.95);
      const link = document.createElement("a");
      link.href = dataURL;
      link.download =
        "socolor-preview." + (format === "jpg" ? "jpg" : "png");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function updateGradientToolbarVisibility() {
      const toolbar = document.getElementById("gradientToolbar");
      const section = document.getElementById("gradientSection");
      if (!toolbar || !section) return;
      const rect = section.getBoundingClientRect();
      const vh =
        window.innerHeight || document.documentElement.clientHeight;
      const visible = rect.top < vh - 80 && rect.bottom > 120;
      if (visible) toolbar.classList.add("visible");
      else toolbar.classList.remove("visible");
    }

    function updateAll(baseHex) {
      const norm = normalizeHex(baseHex);
      if (!norm) return;
      currentColor = norm;
      const pal = generateProPalettes(norm);
      currentProPalette = pal;
      currentTheoryPalettes = generateTheoryPalettes(norm);

      updateAuroraAndLogo();
      renderSpotPalette("spotPaletteContainer", pal.spot);
      updateGradientsFromCurrent();
      renderTheoryPalettes(currentTheoryPalettes);
      updateTypographyPreview();
      updateIntroHero();
      setInspectorColor(norm);
      updateTextPreview();
    }

    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const baseFromUrl = params.get("base");
      if (baseFromUrl) {
        const normalized = normalizeHex(baseFromUrl);
        if (normalized) currentColor = normalized;
      }

      const colorPicker = document.getElementById("colorPicker");
      const textInput = document.getElementById("textInput");
      colorPicker.value = currentColor;
      textInput.value = currentColor.slice(1).toUpperCase();

      colorPicker.addEventListener("input", e => {
        const hex = e.target.value;
        textInput.value = hex.slice(1).toUpperCase();
        updateAll(hex);
      });
      textInput.addEventListener("input", e => {
        let raw = e.target.value
          .replace(/#/g, "")
          .replace(/[^0-9A-Fa-f]/g, "");
        if (raw.length > 6) raw = raw.slice(0, 6);
        e.target.value = raw.toUpperCase();
        if (raw.length === 6) {
          const hex = "#" + raw;
          if (normalizeHex(hex)) {
            colorPicker.value = hex;
            updateAll(hex);
          }
        }
      });

      initStyleSelector();
      setLayout("center");

      ["inputHeading", "inputSub", "inputBody"].forEach(id => {
        const el = document.getElementById(id);
        el && el.addEventListener("input", updateTypographyPreview);
      });

      const previewBgColor = document.getElementById("previewBgColor");
      const previewTextColor = document.getElementById("previewTextColor");
      const suggestTextBtn = document.getElementById("suggestTextBtn");
      previewBgColor.addEventListener("input", updateTextPreview);
      previewTextColor.addEventListener("input", updateTextPreview);
      suggestTextBtn.addEventListener("click", () => {
        const bg = previewBgColor.value || "#ffffff";
        const suggestion = suggestTextColorForBackground(bg);
        previewTextColor.value = suggestion.textColor;
        updateTextPreview();
        alert(
          "Đề xuất màu chữ: " +
          suggestion.textColor +
          " (contrast ~ " +
          suggestion.ratio +
          ":1 " +
          (suggestion.passesAA ? "đạt AA" : "không đạt AA") +
          ")"
        );
      });

      const inspBgInput = document.getElementById("inspBgInput");
      inspectorBg = inspBgInput.value || "#ffffff";
      document.getElementById("inspBgLabel").textContent =
        inspectorBg.toUpperCase();
      inspBgInput.addEventListener("input", e => {
        inspectorBg = e.target.value || "#ffffff";
        document.getElementById("inspBgLabel").textContent =
          inspectorBg.toUpperCase();
        updateInspector();
        renderTheoryPalettes(currentTheoryPalettes);
        if (currentProPalette)
          renderSpotPalette("spotPaletteContainer", currentProPalette.spot);
      });

      document.getElementById("inspTabRgb").addEventListener("click", () =>
        setInspectorModel("rgb")
      );
      document.getElementById("inspTabHsl").addEventListener("click", () =>
        setInspectorModel("hsl")
      );
      document.getElementById("inspTabHsv").addEventListener("click", () =>
        setInspectorModel("hsv")
      );

      updateAll(currentColor);
      updateGradientToolbarVisibility();
      updateTextPreview();

      window.addEventListener("scroll", () => {
        const doc = document.documentElement;
        const maxScroll = doc.scrollHeight - window.innerHeight;
        if (maxScroll > 0) {
          const ratio = window.scrollY / maxScroll;
          const offset = ratio * 40;
          const auroraBg = document.querySelector(".aurora-bg");
          if (auroraBg) auroraBg.style.transform = "translateY(" + -offset + "px)";
        }
        updateGradientToolbarVisibility();
      });
      window.addEventListener("resize", updateGradientToolbarVisibility);
    });

    function randomColor() {
      const hex = chroma.random().hex();
      document.getElementById("colorPicker").value = hex;
      document.getElementById("textInput").value = hex.slice(1).toUpperCase();
      updateAll(hex);
    }
  </script>
</body>
</html>
